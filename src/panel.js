// Load WASM
WebAssembly.instantiateStreaming(
    fetch("data:application/wasm;base64,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H0YbdCEDA0AgBCADQR12QQRxakEQaiIFKAIAIgJFDQIgA0EBdCEDIAIhBCACKAIEQXhxIAFHDQALCyACKAIIIgMgADYCDCACIAA2AgggAEEANgIYIAAgAjYCDCAAIAM2AggPCyAFIAA2AgAgACAENgIYCyAAIAA2AgwgACAANgIIC7oCAQV/IAAoAhghAQJAAkACQCAAKAIMIgIgAEcNACAAQRRBECAAQRRqIgIoAgAiAxtqKAIAIgQNAUEAIQIMAgsgACgCCCIEIAI2AgwgAiAENgIIDAELIAIgAEEQaiADGyEDA0AgAyEFAkAgBCICQRRqIgMoAgAiBA0AIAJBEGohAyACKAIQIQQLIAQNAAsgBUEANgIACwJAIAFFDQACQAJAIAAoAhxBAnRBmILAAGoiBCgCACAARg0AIAFBEEEUIAEoAhAgAEYbaiACNgIAIAINAQwCCyAEIAI2AgAgAg0AQQBBACgCjIBAQX4gACgCHHdxNgKMgEAPCyACIAE2AhgCQCAAKAIQIgRFDQAgAiAENgIQIAQgAjYCGAsgAEEUaigCACIERQ0AIAJBFGogBDYCACAEIAI2AhgPCwsrAAJAIABBfEsNAAJAIAANAEEEDwsgACAAQX1JQQJ0EAMiAEUNACAADwsACxAAAkAgAUUNACAAEAELQSoLC5GAgIAAAQBBgIDAAAsIBAAAAAAAAAAAooOAgAAEbmFtZQGXg4CAAAgAOmRsbWFsbG9jOjpkbG1hbGxvYzo6RGxtYWxsb2M8QT46Om1hbGxvYzo6aGVlYjY5M2M3MjNkNzdmYTABOGRsbWFsbG9jOjpkbG1hbGxvYzo6RGxtYWxsb2M8QT46OmZyZWU6OmhiMDdlZWZkMzFlYWNkODRjAkFkbG1hbGxvYzo6ZGxtYWxsb2M6OkRsbWFsbG9jPEE+OjpkaXNwb3NlX2NodW5rOjpoM2VlODExYjMyZTMzZGRiNAMwZGxtYWxsb2M6OkRsbWFsbG9jPEE+OjptYWxsb2M6OmhiZDJiMmE1NjFlMGVmNjcwBEZkbG1hbGxvYzo6ZGxtYWxsb2M6OkRsbWFsbG9jPEE+OjppbnNlcnRfbGFyZ2VfY2h1bms6OmgyZDdhYjRjZDIxYjliMWU4BUZkbG1hbGxvYzo6ZGxtYWxsb2M6OkRsbWFsbG9jPEE+Ojp1bmxpbmtfbGFyZ2VfY2h1bms6OmhiMDc5MjVmMDMyY2M4NjQ4BhFfX3diaW5kZ2VuX21hbGxvYwcGZGVjb2RlAO+AgIAACXByb2R1Y2VycwIIbGFuZ3VhZ2UBBFJ1c3QADHByb2Nlc3NlZC1ieQMFcnVzdGMdMS41Ni4xICg1OWVlZDhhMmEgMjAyMS0xMS0wMSkGd2FscnVzBjAuMTkuMAx3YXNtLWJpbmRnZW4GMC4yLjc4")
)
    .then(obj => obj.instance.exports)
    .then(initialize);

function initialize(candid) {
    const log = [];

    // Start capture
    chrome.devtools.network.onRequestFinished.addListener((request) => capture(candid, log, request));
};

// Decode and log Dfinity CBOR/Candid network events.
function capture(candid, log, request) {

    // Look for a cbor content type header.
    const isCBOR = request.response.headers
        .find(x => x.name === 'content-type')
        ?.value === 'application/cbor';

    function decode(value) {
        return candid.decode(value);
    };

    if (isCBOR) {
        request.getContent((content, encoding) => {

            if (encoding !== 'base64') {
                // Janky AF, but AFAIK all IC responses are b64 encoded.
                return
            };

            // Assumption from here is that this is an IC request.

            // Chrome gives us the request body decoded into utf8?
            // It's busted, so we reencode it.
            const requestB64 = btoa(request?.request?.postData?.text);

            // Decode request.
            const requestBytes = _base64ToBytes(requestB64);
            const requestCBOR = CBOR.decode(requestBytes.buffer);
            // const requestHex = toHexString(requestBytes);

            // Decode response.
            const responseBytes = _base64ToBytes(content);
            const responseCBOR = CBOR.decode(responseBytes.buffer);
            // const responseHex = toHexString(responseBytes);

            // Find candid values.
            // Assumption: all candid values are Uint8Array and all Uint8Array values are candid.
            function findCandid(object) {
                let candidFields = {};
                for (let [key, value] of Object.entries(object)) {
                    // Capture and decode Uint8Arrays.
                    if (value instanceof Uint8Array) {
                        candidFields[key] = decode(Uint8Array.from(value));
                        // Recurse downward.
                    } else if (typeof value === 'object') {
                        candidFields[key] = findCandid(value);
                    };
                };
                return candidFields;
            };

            const requestCandid = findCandid(requestCBOR);
            const responseCandid = findCandid(responseCBOR);

            const decodedRequest = mergeDeep({}, requestCBOR, requestCandid);
            const decodedResponse = mergeDeep({}, responseCBOR, responseCandid);

            // console.log(requestCandid, requestCBOR, decodedRequest);

            log.push({
                url: request.request.url,
                request: decodedRequest,
                response: decodedResponse,
            });

            document.getElementById('log').innerHTML = renderLog(log);

        });
    };
}

// Render decoded logs
const renderLog = (log) => `${log.map(entry => `
    <div>
        <div><strong>URL: </strong>${entry.url}</div>
        <div><strong>Request: </strong>${JSON.stringify(entry.request, undefined, 4)}</div>
        <div><strong>Response: </strong>${JSON.stringify(entry.response, undefined, 4)}</div>
    </div>
`).join('<hr />')}`;

// Converting things...
function _base64ToBytes(base64) {
    var binary_string = window.atob(base64);
    var len = binary_string.length;
    var bytes = new Uint8Array(len);
    for (var i = 0; i < len; i++) {
        bytes[i] = binary_string.charCodeAt(i);
    }
    return bytes;
}

function toHexString(byteArray) {
    return Array.from(byteArray).map(x => {
        return byteToHex(x);
    }).join(' ');
}

var hexChar = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "A", "B", "C", "D", "E", "F"];

function byteToHex(b) {
    return hexChar[(b >> 4) & 0x0f] + hexChar[b & 0x0f];
}

/**
 * Simple object check.
 * @param item
 * @returns {boolean}
 */
function isObject(item) {
    return (item && typeof item === 'object');
}

/**
 * Deep merge two objects.
 * @param target
 * @param ...sources
 */
function mergeDeep(target, ...sources) {
    if (!sources.length) return target;
    const source = sources.shift();

    if (isObject(target) && isObject(source)) {
        for (const key in source) {
            if (isObject(source[key])) {
                if (!target[key]) Object.assign(target, { [key]: {} });
                mergeDeep(target[key], source[key]);
            } else {
                Object.assign(target, { [key]: source[key] });
            }
        }
    }

    return mergeDeep(target, ...sources);
}